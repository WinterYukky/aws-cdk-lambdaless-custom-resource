{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.238.0"},"children":{"AutoDeleteObjectsIntegTest":{"id":"AutoDeleteObjectsIntegTest","path":"AutoDeleteObjectsIntegTest","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.238.0"},"children":{"Bucket":{"id":"Bucket","path":"AutoDeleteObjectsIntegTest/Bucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"AutoDeleteObjectsIntegTest/Bucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"tags":[{"key":"aws-cdk:auto-delete-objects","value":"true"}],"versioningConfiguration":{"status":"Enabled"}}}}}},"AutoDelete":{"id":"AutoDelete","path":"AutoDeleteObjectsIntegTest/AutoDelete","constructInfo":{"fqn":"constructs.Construct","version":"10.0.5"},"children":{"GetBucketTagging":{"id":"GetBucketTagging","path":"AutoDeleteObjectsIntegTest/AutoDelete/GetBucketTagging","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.CallAwsService","version":"2.238.0"}},"SkipDeletion":{"id":"SkipDeletion","path":"AutoDeleteObjectsIntegTest/AutoDelete/SkipDeletion","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Pass","version":"2.238.0"}},"GetBucketPolicy":{"id":"GetBucketPolicy","path":"AutoDeleteObjectsIntegTest/AutoDelete/GetBucketPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.CallAwsService","version":"2.238.0"}},"NoPolicyFound":{"id":"NoPolicyFound","path":"AutoDeleteObjectsIntegTest/AutoDelete/NoPolicyFound","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Pass","version":"2.238.0"}},"DenyWrites":{"id":"DenyWrites","path":"AutoDeleteObjectsIntegTest/AutoDelete/DenyWrites","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.CallAwsService","version":"2.238.0"}},"DenyWritesFailed":{"id":"DenyWritesFailed","path":"AutoDeleteObjectsIntegTest/AutoDelete/DenyWritesFailed","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Pass","version":"2.238.0"}},"ListObjectVersions":{"id":"ListObjectVersions","path":"AutoDeleteObjectsIntegTest/AutoDelete/ListObjectVersions","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.CallAwsService","version":"2.238.0"}},"DeleteObjects":{"id":"DeleteObjects","path":"AutoDeleteObjectsIntegTest/AutoDelete/DeleteObjects","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.CallAwsService","version":"2.238.0"}},"MoreObjects?":{"id":"MoreObjects?","path":"AutoDeleteObjectsIntegTest/AutoDelete/MoreObjects?","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Choice","version":"2.238.0"}},"Done":{"id":"Done","path":"AutoDeleteObjectsIntegTest/AutoDelete/Done","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Pass","version":"2.238.0"}},"HasObjects?":{"id":"HasObjects?","path":"AutoDeleteObjectsIntegTest/AutoDelete/HasObjects?","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Choice","version":"2.238.0"}},"BucketEmpty":{"id":"BucketEmpty","path":"AutoDeleteObjectsIntegTest/AutoDelete/BucketEmpty","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Pass","version":"2.238.0"}},"BucketDoesNotExist":{"id":"BucketDoesNotExist","path":"AutoDeleteObjectsIntegTest/AutoDelete/BucketDoesNotExist","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Pass","version":"2.238.0"}},"IsTaggedForDeletion?":{"id":"IsTaggedForDeletion?","path":"AutoDeleteObjectsIntegTest/AutoDelete/IsTaggedForDeletion?","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Choice","version":"2.238.0"}},"CheckTagError":{"id":"CheckTagError","path":"AutoDeleteObjectsIntegTest/AutoDelete/CheckTagError","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Choice","version":"2.238.0"}},"CreateNoOp":{"id":"CreateNoOp","path":"AutoDeleteObjectsIntegTest/AutoDelete/CreateNoOp","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Pass","version":"2.238.0"}},"UpdateBucketName":{"id":"UpdateBucketName","path":"AutoDeleteObjectsIntegTest/AutoDelete/UpdateBucketName","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Pass","version":"2.238.0"}},"Flow":{"id":"Flow","path":"AutoDeleteObjectsIntegTest/AutoDelete/Flow","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.StateMachineFragment","version":"2.238.0"},"children":{"Which Request Type?":{"id":"Which Request Type?","path":"AutoDeleteObjectsIntegTest/AutoDelete/Flow/Which Request Type?","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Choice","version":"2.238.0"}},"Initialize":{"id":"Initialize","path":"AutoDeleteObjectsIntegTest/AutoDelete/Flow/Initialize","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Pass","version":"2.238.0"}}}},"StateMachine":{"id":"StateMachine","path":"AutoDeleteObjectsIntegTest/AutoDelete/StateMachine","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.StateMachine","version":"2.238.0"},"children":{"Role":{"id":"Role","path":"AutoDeleteObjectsIntegTest/AutoDelete/StateMachine/Role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"AutoDeleteObjectsIntegTest/AutoDelete/StateMachine/Role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"states.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AutoDeleteObjectsIntegTest/AutoDelete/StateMachine/Role/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"AutoDeleteObjectsIntegTest/AutoDelete/StateMachine/Role/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:GetBucketPolicy","s3:GetBucketTagging","s3:PutBucketPolicy","s3:deleteObjects","s3:getBucketPolicy","s3:getBucketTagging","s3:putBucketPolicy"],"Effect":"Allow","Resource":{"Fn::GetAtt":["Bucket83908E77","Arn"]}},{"Action":["s3:GetBucket*","s3:GetObject*","s3:List*","s3:listObjectVersions"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["Bucket83908E77","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["Bucket83908E77","Arn"]},"/*"]]}]},{"Action":"s3:DeleteObject*","Effect":"Allow","Resource":{"Fn::Join":["",[{"Fn::GetAtt":["Bucket83908E77","Arn"]},"/*"]]}}],"Version":"2012-10-17"},"policyName":"AutoDeleteStateMachineRoleDefaultPolicy16E0A8D7","roles":[{"Ref":"AutoDeleteStateMachineRoleC1391740"}]}}}}}}},"Resource":{"id":"Resource","path":"AutoDeleteObjectsIntegTest/AutoDelete/StateMachine/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.CfnStateMachine","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::StepFunctions::StateMachine","aws:cdk:cloudformation:props":{"definitionString":{"Fn::Join":["",["{\"StartAt\":\"Initialize\",\"States\":{\"Initialize\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Next\":\"Which Request Type?\",\"Assign\":{\"RequestType\":\"{% $states.input.RequestType %}\",\"StackId\":\"{% $states.input.StackId %}\",\"RequestId\":\"{% $states.input.RequestId %}\",\"ResourceType\":\"{% $states.input.ResourceType %}\",\"LogicalResourceId\":\"{% $states.input.LogicalResourceId %}\",\"PhysicalResourceId\":\"{% $exists($states.input.PhysicalResourceId) ? $states.input.PhysicalResourceId : null %}\",\"ResourceProperties\":\"{% $states.input.ResourceProperties %}\",\"OldResourceProperties\":\"{% $exists($states.input.OldResourceProperties) ? $states.input.OldResourceProperties : null %}\"}},\"Which Request Type?\":{\"Type\":\"Choice\",\"QueryLanguage\":\"JSONata\",\"Choices\":[{\"Condition\":\"{% $RequestType = \\\"Create\\\" %}\",\"Next\":\"CreateNoOp\"},{\"Condition\":\"{% $RequestType = \\\"Update\\\" %}\",\"Next\":\"UpdateBucketName\"},{\"Condition\":\"{% $RequestType = \\\"Delete\\\" %}\",\"Next\":\"GetBucketTagging\"}]},\"CreateNoOp\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Output\":{\"PhysicalResourceId\":\"{% $ResourceProperties.BucketName %}\"},\"End\":true},\"UpdateBucketName\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Output\":{\"PhysicalResourceId\":\"{% $ResourceProperties.BucketName %}\"},\"End\":true},\"GetBucketTagging\":{\"QueryLanguage\":\"JSONata\",\"Next\":\"IsTaggedForDeletion?\",\"Catch\":[{\"Output\":\"{% $states.errorOutput %}\",\"ErrorEquals\":[\"States.ALL\"],\"Next\":\"CheckTagError\"}],\"Type\":\"Task\",\"Arguments\":{\"Bucket\":\"{% $ResourceProperties.BucketName %}\"},\"Assign\":{\"IsTagged\":\"{% $exists($states.result.TagSet[$lowercase(Key) = 'aws-cdk:auto-delete-objects' and Value = 'true']) %}\"},\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::aws-sdk:s3:getBucketTagging\"},\"IsTaggedForDeletion?\":{\"Type\":\"Choice\",\"QueryLanguage\":\"JSONata\",\"Choices\":[{\"Condition\":\"{% $IsTagged = true %}\",\"Next\":\"GetBucketPolicy\"}],\"Default\":\"SkipDeletion\"},\"SkipDeletion\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Output\":{\"PhysicalResourceId\":\"{% $ResourceProperties.BucketName %}\"},\"End\":true},\"GetBucketPolicy\":{\"QueryLanguage\":\"JSONata\",\"Next\":\"DenyWrites\",\"Catch\":[{\"Output\":\"{% $states.errorOutput %}\",\"ErrorEquals\":[\"States.ALL\"],\"Next\":\"NoPolicyFound\"}],\"Type\":\"Task\",\"Arguments\":{\"Bucket\":\"{% $ResourceProperties.BucketName %}\"},\"Assign\":{\"ExistingPolicy\":\"{% $exists($states.result.Policy) ? $parse($states.result.Policy) : {\\\"Version\\\": \\\"2012-10-17\\\", \\\"Statement\\\": []} %}\"},\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::aws-sdk:s3:getBucketPolicy\"},\"DenyWrites\":{\"QueryLanguage\":\"JSONata\",\"Next\":\"ListObjectVersions\",\"Catch\":[{\"Output\":\"{% $states.errorOutput %}\",\"ErrorEquals\":[\"States.ALL\"],\"Next\":\"DenyWritesFailed\"}],\"Type\":\"Task\",\"Arguments\":{\"Bucket\":\"{% $ResourceProperties.BucketName %}\",\"Policy\":\"{% $string($merge([$ExistingPolicy, {\\\"Statement\\\": $append($ExistingPolicy.Statement, [{\\\"Principal\\\": \\\"*\\\", \\\"Effect\\\": \\\"Deny\\\", \\\"Action\\\": [\\\"s3:PutObject\\\"], \\\"Resource\\\": [\\\"arn:aws:s3:::\\\" & $ResourceProperties.BucketName & \\\"/*\\\"]}])}])) %}\"},\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::aws-sdk:s3:putBucketPolicy\"},\"NoPolicyFound\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Next\":\"DenyWrites\",\"Assign\":{\"ExistingPolicy\":{\"Version\":\"2012-10-17\",\"Statement\":[]}}},\"ListObjectVersions\":{\"QueryLanguage\":\"JSONata\",\"Next\":\"HasObjects?\",\"Type\":\"Task\",\"Arguments\":{\"Bucket\":\"{% $ResourceProperties.BucketName %}\",\"MaxKeys\":100},\"Assign\":{\"Objects\":\"{% [($states.result.Versions ~> $map(function($v) { {\\\"Key\\\": $v.Key, \\\"VersionId\\\": $v.VersionId} })), ($states.result.DeleteMarkers ~> $map(function($v) { {\\\"Key\\\": $v.Key, \\\"VersionId\\\": $v.VersionId} }))] %}\",\"IsTruncated\":\"{% $states.result.IsTruncated %}\"},\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::aws-sdk:s3:listObjectVersions\"},\"MoreObjects?\":{\"Type\":\"Choice\",\"QueryLanguage\":\"JSONata\",\"Choices\":[{\"Condition\":\"{% $IsTruncated = true %}\",\"Next\":\"ListObjectVersions\"}],\"Default\":\"Done\"},\"DeleteObjects\":{\"QueryLanguage\":\"JSONata\",\"Next\":\"MoreObjects?\",\"Type\":\"Task\",\"Arguments\":{\"Bucket\":\"{% $ResourceProperties.BucketName %}\",\"Delete\":{\"Objects\":\"{% $Objects %}\"}},\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::aws-sdk:s3:deleteObjects\"},\"HasObjects?\":{\"Type\":\"Choice\",\"QueryLanguage\":\"JSONata\",\"Choices\":[{\"Condition\":\"{% $count($Objects) > 0 %}\",\"Next\":\"DeleteObjects\"}],\"Default\":\"BucketEmpty\"},\"BucketEmpty\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Output\":{\"PhysicalResourceId\":\"{% $ResourceProperties.BucketName %}\"},\"End\":true},\"Done\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Output\":{\"PhysicalResourceId\":\"{% $ResourceProperties.BucketName %}\"},\"End\":true},\"DenyWritesFailed\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Comment\":\"Non-fatal: bucket deletion should still proceed\",\"End\":true},\"CheckTagError\":{\"Type\":\"Choice\",\"QueryLanguage\":\"JSONata\",\"Choices\":[{\"Condition\":\"{% $contains($states.input.Cause, 'NoSuchBucket') %}\",\"Next\":\"BucketDoesNotExist\"}],\"Default\":\"BucketDoesNotExist\"},\"BucketDoesNotExist\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Output\":{\"PhysicalResourceId\":\"{% $ResourceProperties.BucketName %}\"},\"End\":true}}}"]]},"roleArn":{"Fn::GetAtt":["AutoDeleteStateMachineRoleC1391740","Arn"]}}}}}},"Resource":{"id":"Resource","path":"AutoDeleteObjectsIntegTest/AutoDelete/Resource","constructInfo":{"fqn":"constructs.Construct","version":"10.0.5"},"children":{"Resource":{"id":"Resource","path":"AutoDeleteObjectsIntegTest/AutoDelete/Resource/Resource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.238.0"},"children":{"Default":{"id":"Default","path":"AutoDeleteObjectsIntegTest/AutoDelete/Resource/Resource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.238.0"}}}},"Policy":{"id":"Policy","path":"AutoDeleteObjectsIntegTest/AutoDelete/Resource/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"AutoDeleteObjectsIntegTest/AutoDelete/Resource/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["states:ListExecutions","states:ListStateMachines","states:StartExecution"],"Effect":"Allow","Resource":{"Ref":"AutoDeleteStateMachine55F3EE41"}},{"Action":["states:DescribeExecution","states:DescribeStateMachineForExecution","states:GetExecutionHistory"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":states:",{"Ref":"AWS::Region"},":",{"Ref":"AWS::AccountId"},":execution:",{"Fn::Select":[6,{"Fn::Split":[":",{"Ref":"AutoDeleteStateMachine55F3EE41"}]}]},":*"]]}},{"Action":["states:DescribeActivity","states:DescribeStateMachine","states:ListActivities"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"AutoDeletePolicyADD00332","roles":[{"Ref":"LambdalessProviderStateMachineRole4BDCD64E"}]}}}}}}}}},"LambdalessProvider":{"id":"LambdalessProvider","path":"AutoDeleteObjectsIntegTest/LambdalessProvider","constructInfo":{"fqn":"constructs.Construct","version":"10.0.5"},"children":{"Topic":{"id":"Topic","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Topic","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Topic","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Topic/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnTopic","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Topic","aws:cdk:cloudformation:props":{}}}}},"Queue":{"id":"Queue","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Queue","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Queue/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{}}},"Policy":{"id":"Policy","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Queue/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.QueuePolicy","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Queue/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueuePolicy","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::QueuePolicy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"sqs:SendMessage","Condition":{"ArnEquals":{"aws:SourceArn":{"Ref":"LambdalessProviderTopic58DC2415"}}},"Effect":"Allow","Principal":{"Service":"sns.amazonaws.com"},"Resource":{"Fn::GetAtt":["LambdalessProviderQueue3E954037","Arn"]}}],"Version":"2012-10-17"},"queues":[{"Ref":"LambdalessProviderQueue3E954037"}]}}}}},"AutoDeleteObjectsIntegTestLambdalessProviderTopic0E023271":{"id":"AutoDeleteObjectsIntegTestLambdalessProviderTopic0E023271","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Queue/AutoDeleteObjectsIntegTestLambdalessProviderTopic0E023271","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Subscription","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Queue/AutoDeleteObjectsIntegTestLambdalessProviderTopic0E023271/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnSubscription","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Subscription","aws:cdk:cloudformation:props":{"endpoint":{"Fn::GetAtt":["LambdalessProviderQueue3E954037","Arn"]},"protocol":"sqs","topicArn":{"Ref":"LambdalessProviderTopic58DC2415"}}}}}}}},"Connection":{"id":"Connection","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Connection","constructInfo":{"fqn":"aws-cdk-lib.aws_events.Connection","version":"2.238.0"},"children":{"Connection":{"id":"Connection","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Connection/Connection","constructInfo":{"fqn":"aws-cdk-lib.aws_events.CfnConnection","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Events::Connection","aws:cdk:cloudformation:props":{"authorizationType":"API_KEY","authParameters":{"apiKeyAuthParameters":{"apiKeyName":"dummy","apiKeyValue":"dummy"}}}}}}},"Initialize":{"id":"Initialize","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Initialize","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Pass","version":"2.238.0"}},"Still Running":{"id":"Still Running","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Still Running","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Wait","version":"2.238.0"}},"Start Execution":{"id":"Start Execution","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Start Execution","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.CallAwsService","version":"2.238.0"}},"Describe Execution":{"id":"Describe Execution","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Describe Execution","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.CallAwsService","version":"2.238.0"}},"Response to CloudFormation":{"id":"Response to CloudFormation","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Response to CloudFormation","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.HttpInvoke","version":"2.238.0"}},"Is finished?":{"id":"Is finished?","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Is finished?","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Choice","version":"2.238.0"}},"Given workflow was failed":{"id":"Given workflow was failed","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Given workflow was failed","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Pass","version":"2.238.0"}},"StateMachine":{"id":"StateMachine","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/StateMachine","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.StateMachine","version":"2.238.0"},"children":{"Role":{"id":"Role","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/StateMachine/Role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/StateMachine/Role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"states.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/StateMachine/Role/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/StateMachine/Role/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["states:describeExecution","states:startExecution"],"Condition":{"StringEquals":{"aws:RequestedRegion":"DISABLED"}},"Effect":"Allow","Resource":"*"},{"Action":"events:RetrieveConnectionCredentials","Effect":"Allow","Resource":{"Fn::GetAtt":["LambdalessProviderConnection803AC994","Arn"]}},{"Action":["secretsmanager:DescribeSecret","secretsmanager:GetSecretValue"],"Effect":"Allow","Resource":{"Fn::GetAtt":["LambdalessProviderConnection803AC994","SecretArn"]}},{"Action":"states:InvokeHTTPEndpoint","Condition":{"StringLike":{"states:HTTPEndpoint":"*"}},"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"LambdalessProviderStateMachineRoleDefaultPolicy613E8B8C","roles":[{"Ref":"LambdalessProviderStateMachineRole4BDCD64E"}]}}}}}}},"Resource":{"id":"Resource","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/StateMachine/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.CfnStateMachine","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::StepFunctions::StateMachine","aws:cdk:cloudformation:props":{"definitionString":{"Fn::Join":["",["{\"StartAt\":\"Initialize\",\"States\":{\"Initialize\":{\"Type\":\"Pass\",\"Next\":\"Describe Execution\",\"Assign\":{\"ExecutionArn\":\"{% $replace($states.input.ResourceProperties.stateMachineArn, 'stateMachine', 'execution') & ':' & $states.input.RequestId %}\",\"RequestType\":\"{% $states.input.RequestType %}\",\"ResponseURL\":\"{% $states.input.ResponseURL %}\",\"StackId\":\"{% $states.input.StackId %}\",\"RequestId\":\"{% $states.input.RequestId %}\",\"ResourceType\":\"{% $states.input.ResourceType %}\",\"LogicalResourceId\":\"{% $states.input.LogicalResourceId %}\",\"PhysicalResourceId\":\"{% $exists($states.input.PhysicalResourceId) ? $states.input.PhysicalResourceId : null %}\",\"ResourceProperties\":\"{% $states.input.ResourceProperties %}\",\"OldResourceProperties\":\"{% $exists($states.input.OldResourceProperties) ? $states.input.OldResourceProperties : null %}\"}},\"Describe Execution\":{\"Next\":\"Is finished?\",\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"Next\":\"Start Execution\"}],\"Type\":\"Task\",\"Arguments\":{\"ExecutionArn\":\"{% $ExecutionArn %}\",\"IncludedData\":\"ALL_DATA\"},\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::aws-sdk:sfn:describeExecution\"},\"Still Running\":{\"Type\":\"Wait\",\"Seconds\":1,\"Next\":\"Describe Execution\"},\"Start Execution\":{\"Next\":\"Still Running\",\"Type\":\"Task\",\"Arguments\":{\"Name\":\"{% $RequestId %}\",\"Input\":{\"RequestType\":\"{% $RequestType %}\",\"StackId\":\"{% $StackId %}\",\"RequestId\":\"{% $RequestId %}\",\"ResourceType\":\"{% $ResourceType %}\",\"LogicalResourceId\":\"{% $LogicalResourceId %}\",\"PhysicalResourceId\":\"{% $PhysicalResourceId %}\",\"ResourceProperties\":\"{% $ResourceProperties %}\",\"OldResourceProperties\":\"{% $OldResourceProperties %}\"},\"StateMachineArn\":\"{% $ResourceProperties.stateMachineArn %}\"},\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::aws-sdk:sfn:startExecution\"},\"Is finished?\":{\"Type\":\"Choice\",\"Choices\":[{\"Condition\":\"{% $states.input.Status = 'RUNNING' %}\",\"Next\":\"Still Running\"},{\"Condition\":\"{% $states.input.Status = 'SUCCEEDED' %}\",\"Output\":\"{% $parse($states.input.Output) %}\",\"Next\":\"Response to CloudFormation\"}],\"Default\":\"Given workflow was failed\"},\"Given workflow was failed\":{\"Type\":\"Pass\",\"Output\":{\"Status\":\"FAILED\",\"Reason\":\"{% $states.input.Error & ': ' & $states.input.Cause %}\"},\"Next\":\"Response to CloudFormation\"},\"Response to CloudFormation\":{\"End\":true,\"Type\":\"Task\",\"Arguments\":{\"ApiEndpoint\":\"{% $match($ResponseURL, /(https://[^/]+)\\\\/(.*)\\\\?/).groups[0] & '/' & $match($ResponseURL, /(https://[^/]+)\\\\/(.*)\\\\?/).groups[1] ~> $decodeUrlComponent() %}\",\"Authentication\":{\"ConnectionArn\":\"",{"Fn::GetAtt":["LambdalessProviderConnection803AC994","Arn"]},"\"},\"Method\":\"PUT\",\"RequestBody\":{\"Status\":\"{% $exists($states.input.Status) ? $states.input.Status : 'SUCCESS' %}\",\"StackId\":\"{% $StackId %}\",\"RequestId\":\"{% $RequestId %}\",\"LogicalResourceId\":\"{% $LogicalResourceId %}\",\"Data\":\"{% (\\n            $deepSpread := function($value, $path, $arr) {(\\n                $arr := $arr ? $arr : [];\\n                $t := $type($value);\\n                $result := \\n                $t = \\\"object\\\" ? $each($value, function($v, $k){\\n                    $deepSpread($v, $path ? $path & \\\".\\\" & $k : $k, $arr)\\n                }) : \\n                $t = \\\"array\\\" ? $map($value, function($el, $index){\\n                    $deepSpread($el, $path ? $path & \\\".\\\" & $string($index) : $string($index), $arr)\\n                }) :\\n                {\\n                    $path: $string($value)\\n                };\\n                $append($arr, $result) ~> $merge\\n            )};\\n            $exists($states.input.Data) ? $deepSpread($states.input.Data) : {}\\n            ) %}\",\"NoEcho\":\"{% $exists($states.input.NoEcho) ? $states.input.NoEcho : false %}\",\"PhysicalResourceId\":\"{% $exists($states.input.PhysicalResourceId) ? $states.input.PhysicalResourceId : $RequestId %}\",\"Reason\":\"{% $exists($states.input.Reason) ? $states.input.Reason : '' %}\"},\"QueryParameters\":\"{% $ResponseURL ~> $substringAfter('?') ~> $split('&') ~> $map(function($v) {( $kv := $split($v, '='); {$kv[0]: $decodeUrlComponent($kv[1])} )}) ~> $merge %}\"},\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::http:invoke\"}},\"QueryLanguage\":\"JSONata\"}"]]},"roleArn":{"Fn::GetAtt":["LambdalessProviderStateMachineRole4BDCD64E","Arn"]},"stateMachineType":"EXPRESS"}}}}},"Pipe":{"id":"Pipe","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Pipe","constructInfo":{"fqn":"constructs.Construct","version":"10.0.5"},"children":{"Role":{"id":"Role","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Pipe/Role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Pipe/Role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"pipes.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Pipe/Role/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.238.0"},"children":{"Resource":{"id":"Resource","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Pipe/Role/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["sqs:ChangeMessageVisibility","sqs:DeleteMessage","sqs:GetQueueAttributes","sqs:GetQueueUrl","sqs:ReceiveMessage"],"Effect":"Allow","Resource":{"Fn::GetAtt":["LambdalessProviderQueue3E954037","Arn"]}},{"Action":"states:StartSyncExecution","Effect":"Allow","Resource":{"Ref":"LambdalessProviderStateMachine7D8C8128"}}],"Version":"2012-10-17"},"policyName":"LambdalessProviderPipeRoleDefaultPolicy918C6032","roles":[{"Ref":"LambdalessProviderPipeRoleD3BC051F"}]}}}}}}},"Resource":{"id":"Resource","path":"AutoDeleteObjectsIntegTest/LambdalessProvider/Pipe/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_pipes.CfnPipe","version":"2.238.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Pipes::Pipe","aws:cdk:cloudformation:props":{"description":"Auto generated by AWS CDK Custom Resource","roleArn":{"Fn::GetAtt":["LambdalessProviderPipeRoleD3BC051F","Arn"]},"source":{"Fn::GetAtt":["LambdalessProviderQueue3E954037","Arn"]},"sourceParameters":{"sqsQueueParameters":{"batchSize":1}},"target":{"Ref":"LambdalessProviderStateMachine7D8C8128"},"targetParameters":{"inputTemplate":"<$.body.Message>","stepFunctionStateMachineParameters":{"invocationType":"REQUEST_RESPONSE"}}}}}}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"AutoDeleteObjectsIntegTest/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.238.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"AutoDeleteObjectsIntegTest/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.238.0"}}}},"AutoDeleteObjectsTest":{"id":"AutoDeleteObjectsTest","path":"AutoDeleteObjectsTest","constructInfo":{"fqn":"@aws-cdk/integ-tests-alpha.IntegTest","version":"2.238.0-alpha.0"},"children":{"DefaultTest":{"id":"DefaultTest","path":"AutoDeleteObjectsTest/DefaultTest","constructInfo":{"fqn":"@aws-cdk/integ-tests-alpha.IntegTestCase","version":"2.238.0-alpha.0"},"children":{"Default":{"id":"Default","path":"AutoDeleteObjectsTest/DefaultTest/Default","constructInfo":{"fqn":"constructs.Construct","version":"10.0.5"}},"DeployAssert":{"id":"DeployAssert","path":"AutoDeleteObjectsTest/DefaultTest/DeployAssert","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.238.0"},"children":{"BootstrapVersion":{"id":"BootstrapVersion","path":"AutoDeleteObjectsTest/DefaultTest/DeployAssert/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.238.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"AutoDeleteObjectsTest/DefaultTest/DeployAssert/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.238.0"}}}}}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.0.5"}}}}}