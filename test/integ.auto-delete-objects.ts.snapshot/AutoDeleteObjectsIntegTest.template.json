{
 "Resources": {
  "Bucket83908E77": {
   "Type": "AWS::S3::Bucket",
   "Properties": {
    "Tags": [
     {
      "Key": "aws-cdk:auto-delete-objects",
      "Value": "true"
     }
    ],
    "VersioningConfiguration": {
     "Status": "Enabled"
    }
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "AutoDeleteStateMachineRoleC1391740": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "states.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "AutoDeleteStateMachineRoleDefaultPolicy16E0A8D7": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "s3:GetBucketPolicy",
        "s3:GetBucketTagging",
        "s3:PutBucketPolicy",
        "s3:deleteObjects",
        "s3:getBucketPolicy",
        "s3:getBucketTagging",
        "s3:putBucketPolicy"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "Bucket83908E77",
         "Arn"
        ]
       }
      },
      {
       "Action": [
        "s3:GetBucket*",
        "s3:GetObject*",
        "s3:List*",
        "s3:listObjectVersions"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "Bucket83908E77",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "Bucket83908E77",
             "Arn"
            ]
           },
           "/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": "s3:DeleteObject*",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          {
           "Fn::GetAtt": [
            "Bucket83908E77",
            "Arn"
           ]
          },
          "/*"
         ]
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "AutoDeleteStateMachineRoleDefaultPolicy16E0A8D7",
    "Roles": [
     {
      "Ref": "AutoDeleteStateMachineRoleC1391740"
     }
    ]
   }
  },
  "AutoDeleteStateMachine55F3EE41": {
   "Type": "AWS::StepFunctions::StateMachine",
   "Properties": {
    "DefinitionString": {
     "Fn::Join": [
      "",
      [
       "{\"StartAt\":\"Initialize\",\"States\":{\"Initialize\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Next\":\"Which Request Type?\",\"Assign\":{\"RequestType\":\"{% $states.input.RequestType %}\",\"StackId\":\"{% $states.input.StackId %}\",\"RequestId\":\"{% $states.input.RequestId %}\",\"ResourceType\":\"{% $states.input.ResourceType %}\",\"LogicalResourceId\":\"{% $states.input.LogicalResourceId %}\",\"PhysicalResourceId\":\"{% $exists($states.input.PhysicalResourceId) ? $states.input.PhysicalResourceId : null %}\",\"ResourceProperties\":\"{% $states.input.ResourceProperties %}\",\"OldResourceProperties\":\"{% $exists($states.input.OldResourceProperties) ? $states.input.OldResourceProperties : null %}\"}},\"Which Request Type?\":{\"Type\":\"Choice\",\"QueryLanguage\":\"JSONata\",\"Choices\":[{\"Condition\":\"{% $RequestType = \\\"Create\\\" %}\",\"Next\":\"CreateNoOp\"},{\"Condition\":\"{% $RequestType = \\\"Update\\\" %}\",\"Next\":\"UpdateBucketName\"},{\"Condition\":\"{% $RequestType = \\\"Delete\\\" %}\",\"Next\":\"GetBucketTagging\"}]},\"CreateNoOp\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Output\":{\"PhysicalResourceId\":\"{% $ResourceProperties.BucketName %}\"},\"End\":true},\"UpdateBucketName\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Output\":{\"PhysicalResourceId\":\"{% $ResourceProperties.BucketName %}\"},\"End\":true},\"GetBucketTagging\":{\"QueryLanguage\":\"JSONata\",\"Next\":\"IsTaggedForDeletion?\",\"Catch\":[{\"Output\":\"{% $states.errorOutput %}\",\"ErrorEquals\":[\"States.ALL\"],\"Next\":\"CheckTagError\"}],\"Type\":\"Task\",\"Arguments\":{\"Bucket\":\"{% $ResourceProperties.BucketName %}\"},\"Assign\":{\"IsTagged\":\"{% $exists($states.result.TagSet[$lowercase(Key) = 'aws-cdk:auto-delete-objects' and Value = 'true']) %}\"},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:s3:getBucketTagging\"},\"IsTaggedForDeletion?\":{\"Type\":\"Choice\",\"QueryLanguage\":\"JSONata\",\"Choices\":[{\"Condition\":\"{% $IsTagged = true %}\",\"Next\":\"GetBucketPolicy\"}],\"Default\":\"SkipDeletion\"},\"SkipDeletion\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Output\":{\"PhysicalResourceId\":\"{% $ResourceProperties.BucketName %}\"},\"End\":true},\"GetBucketPolicy\":{\"QueryLanguage\":\"JSONata\",\"Next\":\"DenyWrites\",\"Catch\":[{\"Output\":\"{% $states.errorOutput %}\",\"ErrorEquals\":[\"States.ALL\"],\"Next\":\"NoPolicyFound\"}],\"Type\":\"Task\",\"Arguments\":{\"Bucket\":\"{% $ResourceProperties.BucketName %}\"},\"Assign\":{\"ExistingPolicy\":\"{% $exists($states.result.Policy) ? $parse($states.result.Policy) : {\\\"Version\\\": \\\"2012-10-17\\\", \\\"Statement\\\": []} %}\"},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:s3:getBucketPolicy\"},\"DenyWrites\":{\"QueryLanguage\":\"JSONata\",\"Next\":\"ListObjectVersions\",\"Catch\":[{\"Output\":\"{% $states.errorOutput %}\",\"ErrorEquals\":[\"States.ALL\"],\"Next\":\"DenyWritesFailed\"}],\"Type\":\"Task\",\"Arguments\":{\"Bucket\":\"{% $ResourceProperties.BucketName %}\",\"Policy\":\"{% $string($merge([$ExistingPolicy, {\\\"Statement\\\": $append($ExistingPolicy.Statement, [{\\\"Principal\\\": \\\"*\\\", \\\"Effect\\\": \\\"Deny\\\", \\\"Action\\\": [\\\"s3:PutObject\\\"], \\\"Resource\\\": [\\\"arn:aws:s3:::\\\" & $ResourceProperties.BucketName & \\\"/*\\\"]}])}])) %}\"},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:s3:putBucketPolicy\"},\"NoPolicyFound\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Next\":\"DenyWrites\",\"Assign\":{\"ExistingPolicy\":{\"Version\":\"2012-10-17\",\"Statement\":[]}}},\"ListObjectVersions\":{\"QueryLanguage\":\"JSONata\",\"Next\":\"HasObjects?\",\"Type\":\"Task\",\"Arguments\":{\"Bucket\":\"{% $ResourceProperties.BucketName %}\",\"MaxKeys\":100},\"Assign\":{\"Objects\":\"{% [($states.result.Versions ~> $map(function($v) { {\\\"Key\\\": $v.Key, \\\"VersionId\\\": $v.VersionId} })), ($states.result.DeleteMarkers ~> $map(function($v) { {\\\"Key\\\": $v.Key, \\\"VersionId\\\": $v.VersionId} }))] %}\",\"IsTruncated\":\"{% $states.result.IsTruncated %}\"},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:s3:listObjectVersions\"},\"MoreObjects?\":{\"Type\":\"Choice\",\"QueryLanguage\":\"JSONata\",\"Choices\":[{\"Condition\":\"{% $IsTruncated = true %}\",\"Next\":\"ListObjectVersions\"}],\"Default\":\"Done\"},\"DeleteObjects\":{\"QueryLanguage\":\"JSONata\",\"Next\":\"MoreObjects?\",\"Type\":\"Task\",\"Arguments\":{\"Bucket\":\"{% $ResourceProperties.BucketName %}\",\"Delete\":{\"Objects\":\"{% $Objects %}\"}},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:s3:deleteObjects\"},\"HasObjects?\":{\"Type\":\"Choice\",\"QueryLanguage\":\"JSONata\",\"Choices\":[{\"Condition\":\"{% $count($Objects) > 0 %}\",\"Next\":\"DeleteObjects\"}],\"Default\":\"BucketEmpty\"},\"BucketEmpty\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Output\":{\"PhysicalResourceId\":\"{% $ResourceProperties.BucketName %}\"},\"End\":true},\"Done\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Output\":{\"PhysicalResourceId\":\"{% $ResourceProperties.BucketName %}\"},\"End\":true},\"DenyWritesFailed\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Comment\":\"Non-fatal: bucket deletion should still proceed\",\"End\":true},\"CheckTagError\":{\"Type\":\"Choice\",\"QueryLanguage\":\"JSONata\",\"Choices\":[{\"Condition\":\"{% $contains($states.input.Cause, 'NoSuchBucket') %}\",\"Next\":\"BucketDoesNotExist\"}],\"Default\":\"BucketDoesNotExist\"},\"BucketDoesNotExist\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Output\":{\"PhysicalResourceId\":\"{% $ResourceProperties.BucketName %}\"},\"End\":true}}}"
      ]
     ]
    },
    "RoleArn": {
     "Fn::GetAtt": [
      "AutoDeleteStateMachineRoleC1391740",
      "Arn"
     ]
    }
   },
   "DependsOn": [
    "AutoDeleteStateMachineRoleDefaultPolicy16E0A8D7",
    "AutoDeleteStateMachineRoleC1391740"
   ],
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "AutoDelete5421551D": {
   "Type": "Custom::S3AutoDeleteObjects",
   "Properties": {
    "ServiceToken": {
     "Fn::Join": [
      "",
      [
       "arn:",
       {
        "Fn::Select": [
         1,
         {
          "Fn::Split": [
           ":",
           {
            "Fn::GetAtt": [
             "LambdalessProviderQueueAutoDeleteObjectsIntegTestLambdalessProviderTopic0E02327185EBD92B",
             "Arn"
            ]
           }
          ]
         }
        ]
       },
       ":",
       {
        "Fn::Select": [
         2,
         {
          "Fn::Split": [
           ":",
           {
            "Fn::GetAtt": [
             "LambdalessProviderQueueAutoDeleteObjectsIntegTestLambdalessProviderTopic0E02327185EBD92B",
             "Arn"
            ]
           }
          ]
         }
        ]
       },
       ":",
       {
        "Fn::Select": [
         3,
         {
          "Fn::Split": [
           ":",
           {
            "Fn::GetAtt": [
             "LambdalessProviderQueueAutoDeleteObjectsIntegTestLambdalessProviderTopic0E02327185EBD92B",
             "Arn"
            ]
           }
          ]
         }
        ]
       },
       ":",
       {
        "Fn::Select": [
         4,
         {
          "Fn::Split": [
           ":",
           {
            "Fn::GetAtt": [
             "LambdalessProviderQueueAutoDeleteObjectsIntegTestLambdalessProviderTopic0E02327185EBD92B",
             "Arn"
            ]
           }
          ]
         }
        ]
       },
       ":",
       {
        "Fn::Select": [
         5,
         {
          "Fn::Split": [
           ":",
           {
            "Fn::GetAtt": [
             "LambdalessProviderQueueAutoDeleteObjectsIntegTestLambdalessProviderTopic0E02327185EBD92B",
             "Arn"
            ]
           }
          ]
         }
        ]
       }
      ]
     ]
    },
    "BucketName": {
     "Ref": "Bucket83908E77"
    },
    "stateMachineArn": {
     "Ref": "AutoDeleteStateMachine55F3EE41"
    }
   },
   "DependsOn": [
    "AutoDeletePolicyADD00332",
    "Bucket83908E77"
   ],
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "AutoDeletePolicyADD00332": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "states:ListExecutions",
        "states:ListStateMachines",
        "states:StartExecution"
       ],
       "Effect": "Allow",
       "Resource": {
        "Ref": "AutoDeleteStateMachine55F3EE41"
       }
      },
      {
       "Action": [
        "states:DescribeExecution",
        "states:DescribeStateMachineForExecution",
        "states:GetExecutionHistory"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":states:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":execution:",
          {
           "Fn::Select": [
            6,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "AutoDeleteStateMachine55F3EE41"
              }
             ]
            }
           ]
          },
          ":*"
         ]
        ]
       }
      },
      {
       "Action": [
        "states:DescribeActivity",
        "states:DescribeStateMachine",
        "states:ListActivities"
       ],
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "AutoDeletePolicyADD00332",
    "Roles": [
     {
      "Ref": "LambdalessProviderStateMachineRole4BDCD64E"
     }
    ]
   },
   "DependsOn": [
    "Bucket83908E77"
   ]
  },
  "LambdalessProviderTopic58DC2415": {
   "Type": "AWS::SNS::Topic"
  },
  "LambdalessProviderQueue3E954037": {
   "Type": "AWS::SQS::Queue",
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "LambdalessProviderQueuePolicy16C88515": {
   "Type": "AWS::SQS::QueuePolicy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "sqs:SendMessage",
       "Condition": {
        "ArnEquals": {
         "aws:SourceArn": {
          "Ref": "LambdalessProviderTopic58DC2415"
         }
        }
       },
       "Effect": "Allow",
       "Principal": {
        "Service": "sns.amazonaws.com"
       },
       "Resource": {
        "Fn::GetAtt": [
         "LambdalessProviderQueue3E954037",
         "Arn"
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "Queues": [
     {
      "Ref": "LambdalessProviderQueue3E954037"
     }
    ]
   }
  },
  "LambdalessProviderQueueAutoDeleteObjectsIntegTestLambdalessProviderTopic0E02327185EBD92B": {
   "Type": "AWS::SNS::Subscription",
   "Properties": {
    "Endpoint": {
     "Fn::GetAtt": [
      "LambdalessProviderQueue3E954037",
      "Arn"
     ]
    },
    "Protocol": "sqs",
    "TopicArn": {
     "Ref": "LambdalessProviderTopic58DC2415"
    }
   },
   "DependsOn": [
    "LambdalessProviderPipeE285A459",
    "LambdalessProviderPipeRoleDefaultPolicy918C6032",
    "LambdalessProviderPipeRoleD3BC051F",
    "LambdalessProviderQueuePolicy16C88515"
   ]
  },
  "LambdalessProviderConnection803AC994": {
   "Type": "AWS::Events::Connection",
   "Properties": {
    "AuthParameters": {
     "ApiKeyAuthParameters": {
      "ApiKeyName": "dummy",
      "ApiKeyValue": "dummy"
     }
    },
    "AuthorizationType": "API_KEY"
   }
  },
  "LambdalessProviderStateMachineRole4BDCD64E": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "states.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "LambdalessProviderStateMachineRoleDefaultPolicy613E8B8C": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "states:describeExecution",
        "states:startExecution"
       ],
       "Condition": {
        "StringEquals": {
         "aws:RequestedRegion": "DISABLED"
        }
       },
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": "events:RetrieveConnectionCredentials",
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "LambdalessProviderConnection803AC994",
         "Arn"
        ]
       }
      },
      {
       "Action": [
        "secretsmanager:DescribeSecret",
        "secretsmanager:GetSecretValue"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "LambdalessProviderConnection803AC994",
         "SecretArn"
        ]
       }
      },
      {
       "Action": "states:InvokeHTTPEndpoint",
       "Condition": {
        "StringLike": {
         "states:HTTPEndpoint": "*"
        }
       },
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LambdalessProviderStateMachineRoleDefaultPolicy613E8B8C",
    "Roles": [
     {
      "Ref": "LambdalessProviderStateMachineRole4BDCD64E"
     }
    ]
   }
  },
  "LambdalessProviderStateMachine7D8C8128": {
   "Type": "AWS::StepFunctions::StateMachine",
   "Properties": {
    "DefinitionString": {
     "Fn::Join": [
      "",
      [
       "{\"StartAt\":\"Initialize\",\"States\":{\"Initialize\":{\"Type\":\"Pass\",\"Next\":\"Describe Execution\",\"Assign\":{\"ExecutionArn\":\"{% $replace($states.input.ResourceProperties.stateMachineArn, 'stateMachine', 'execution') & ':' & $states.input.RequestId %}\",\"RequestType\":\"{% $states.input.RequestType %}\",\"ResponseURL\":\"{% $states.input.ResponseURL %}\",\"StackId\":\"{% $states.input.StackId %}\",\"RequestId\":\"{% $states.input.RequestId %}\",\"ResourceType\":\"{% $states.input.ResourceType %}\",\"LogicalResourceId\":\"{% $states.input.LogicalResourceId %}\",\"PhysicalResourceId\":\"{% $exists($states.input.PhysicalResourceId) ? $states.input.PhysicalResourceId : null %}\",\"ResourceProperties\":\"{% $states.input.ResourceProperties %}\",\"OldResourceProperties\":\"{% $exists($states.input.OldResourceProperties) ? $states.input.OldResourceProperties : null %}\"}},\"Describe Execution\":{\"Next\":\"Is finished?\",\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"Next\":\"Start Execution\"}],\"Type\":\"Task\",\"Arguments\":{\"ExecutionArn\":\"{% $ExecutionArn %}\",\"IncludedData\":\"ALL_DATA\"},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:sfn:describeExecution\"},\"Still Running\":{\"Type\":\"Wait\",\"Seconds\":1,\"Next\":\"Describe Execution\"},\"Start Execution\":{\"Next\":\"Still Running\",\"Type\":\"Task\",\"Arguments\":{\"Name\":\"{% $RequestId %}\",\"Input\":{\"RequestType\":\"{% $RequestType %}\",\"StackId\":\"{% $StackId %}\",\"RequestId\":\"{% $RequestId %}\",\"ResourceType\":\"{% $ResourceType %}\",\"LogicalResourceId\":\"{% $LogicalResourceId %}\",\"PhysicalResourceId\":\"{% $PhysicalResourceId %}\",\"ResourceProperties\":\"{% $ResourceProperties %}\",\"OldResourceProperties\":\"{% $OldResourceProperties %}\"},\"StateMachineArn\":\"{% $ResourceProperties.stateMachineArn %}\"},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:sfn:startExecution\"},\"Is finished?\":{\"Type\":\"Choice\",\"Choices\":[{\"Condition\":\"{% $states.input.Status = 'RUNNING' %}\",\"Next\":\"Still Running\"},{\"Condition\":\"{% $states.input.Status = 'SUCCEEDED' %}\",\"Output\":\"{% $parse($states.input.Output) %}\",\"Next\":\"Response to CloudFormation\"}],\"Default\":\"Given workflow was failed\"},\"Given workflow was failed\":{\"Type\":\"Pass\",\"Output\":{\"Status\":\"FAILED\",\"Reason\":\"{% $states.input.Error & ': ' & $states.input.Cause %}\"},\"Next\":\"Response to CloudFormation\"},\"Response to CloudFormation\":{\"End\":true,\"Type\":\"Task\",\"Arguments\":{\"ApiEndpoint\":\"{% $match($ResponseURL, /(https://[^/]+)\\\\/(.*)\\\\?/).groups[0] & '/' & $match($ResponseURL, /(https://[^/]+)\\\\/(.*)\\\\?/).groups[1] ~> $decodeUrlComponent() %}\",\"Authentication\":{\"ConnectionArn\":\"",
       {
        "Fn::GetAtt": [
         "LambdalessProviderConnection803AC994",
         "Arn"
        ]
       },
       "\"},\"Method\":\"PUT\",\"RequestBody\":{\"Status\":\"{% $exists($states.input.Status) ? $states.input.Status : 'SUCCESS' %}\",\"StackId\":\"{% $StackId %}\",\"RequestId\":\"{% $RequestId %}\",\"LogicalResourceId\":\"{% $LogicalResourceId %}\",\"Data\":\"{% (\\n            $deepSpread := function($value, $path, $arr) {(\\n                $arr := $arr ? $arr : [];\\n                $t := $type($value);\\n                $result := \\n                $t = \\\"object\\\" ? $each($value, function($v, $k){\\n                    $deepSpread($v, $path ? $path & \\\".\\\" & $k : $k, $arr)\\n                }) : \\n                $t = \\\"array\\\" ? $map($value, function($el, $index){\\n                    $deepSpread($el, $path ? $path & \\\".\\\" & $string($index) : $string($index), $arr)\\n                }) :\\n                {\\n                    $path: $string($value)\\n                };\\n                $append($arr, $result) ~> $merge\\n            )};\\n            $exists($states.input.Data) ? $deepSpread($states.input.Data) : {}\\n            ) %}\",\"NoEcho\":\"{% $exists($states.input.NoEcho) ? $states.input.NoEcho : false %}\",\"PhysicalResourceId\":\"{% $exists($states.input.PhysicalResourceId) ? $states.input.PhysicalResourceId : $RequestId %}\",\"Reason\":\"{% $exists($states.input.Reason) ? $states.input.Reason : '' %}\"},\"QueryParameters\":\"{% $ResponseURL ~> $substringAfter('?') ~> $split('&') ~> $map(function($v) {( $kv := $split($v, '='); {$kv[0]: $decodeUrlComponent($kv[1])} )}) ~> $merge %}\"},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::http:invoke\"}},\"QueryLanguage\":\"JSONata\"}"
      ]
     ]
    },
    "RoleArn": {
     "Fn::GetAtt": [
      "LambdalessProviderStateMachineRole4BDCD64E",
      "Arn"
     ]
    },
    "StateMachineType": "EXPRESS"
   },
   "DependsOn": [
    "LambdalessProviderStateMachineRoleDefaultPolicy613E8B8C",
    "LambdalessProviderStateMachineRole4BDCD64E"
   ],
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "LambdalessProviderPipeRoleD3BC051F": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "pipes.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "LambdalessProviderPipeRoleDefaultPolicy918C6032": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "sqs:ChangeMessageVisibility",
        "sqs:DeleteMessage",
        "sqs:GetQueueAttributes",
        "sqs:GetQueueUrl",
        "sqs:ReceiveMessage"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "LambdalessProviderQueue3E954037",
         "Arn"
        ]
       }
      },
      {
       "Action": "states:StartSyncExecution",
       "Effect": "Allow",
       "Resource": {
        "Ref": "LambdalessProviderStateMachine7D8C8128"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LambdalessProviderPipeRoleDefaultPolicy918C6032",
    "Roles": [
     {
      "Ref": "LambdalessProviderPipeRoleD3BC051F"
     }
    ]
   }
  },
  "LambdalessProviderPipeE285A459": {
   "Type": "AWS::Pipes::Pipe",
   "Properties": {
    "Description": "Auto generated by AWS CDK Custom Resource",
    "RoleArn": {
     "Fn::GetAtt": [
      "LambdalessProviderPipeRoleD3BC051F",
      "Arn"
     ]
    },
    "Source": {
     "Fn::GetAtt": [
      "LambdalessProviderQueue3E954037",
      "Arn"
     ]
    },
    "SourceParameters": {
     "SqsQueueParameters": {
      "BatchSize": 1
     }
    },
    "Target": {
     "Ref": "LambdalessProviderStateMachine7D8C8128"
    },
    "TargetParameters": {
     "InputTemplate": "<$.body.Message>",
     "StepFunctionStateMachineParameters": {
      "InvocationType": "REQUEST_RESPONSE"
     }
    }
   },
   "DependsOn": [
    "LambdalessProviderPipeRoleDefaultPolicy918C6032",
    "LambdalessProviderPipeRoleD3BC051F"
   ]
  }
 },
 "Parameters": {
  "BootstrapVersion": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/cdk-bootstrap/hnb659fds/version",
   "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
  }
 },
 "Rules": {
  "CheckBootstrapVersion": {
   "Assertions": [
    {
     "Assert": {
      "Fn::Not": [
       {
        "Fn::Contains": [
         [
          "1",
          "2",
          "3",
          "4",
          "5"
         ],
         {
          "Ref": "BootstrapVersion"
         }
        ]
       }
      ]
     },
     "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
    }
   ]
  }
 }
}