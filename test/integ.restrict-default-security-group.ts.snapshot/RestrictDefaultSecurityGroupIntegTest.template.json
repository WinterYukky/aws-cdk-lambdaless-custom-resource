{
 "Resources": {
  "Vpc8378EB38": {
   "Type": "AWS::EC2::VPC",
   "Properties": {
    "CidrBlock": "10.0.0.0/16",
    "EnableDnsHostnames": true,
    "EnableDnsSupport": true,
    "InstanceTenancy": "default",
    "Tags": [
     {
      "Key": "Name",
      "Value": "RestrictDefaultSecurityGroupIntegTest/Vpc"
     }
    ]
   }
  },
  "VpcPublicSubnet1Subnet5C2D37C4": {
   "Type": "AWS::EC2::Subnet",
   "Properties": {
    "AvailabilityZone": {
     "Fn::Select": [
      0,
      {
       "Fn::GetAZs": ""
      }
     ]
    },
    "CidrBlock": "10.0.0.0/18",
    "MapPublicIpOnLaunch": true,
    "Tags": [
     {
      "Key": "aws-cdk:subnet-name",
      "Value": "Public"
     },
     {
      "Key": "aws-cdk:subnet-type",
      "Value": "Public"
     },
     {
      "Key": "Name",
      "Value": "RestrictDefaultSecurityGroupIntegTest/Vpc/PublicSubnet1"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "VpcPublicSubnet1RouteTable6C95E38E": {
   "Type": "AWS::EC2::RouteTable",
   "Properties": {
    "Tags": [
     {
      "Key": "Name",
      "Value": "RestrictDefaultSecurityGroupIntegTest/Vpc/PublicSubnet1"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "VpcPublicSubnet1RouteTableAssociation97140677": {
   "Type": "AWS::EC2::SubnetRouteTableAssociation",
   "Properties": {
    "RouteTableId": {
     "Ref": "VpcPublicSubnet1RouteTable6C95E38E"
    },
    "SubnetId": {
     "Ref": "VpcPublicSubnet1Subnet5C2D37C4"
    }
   }
  },
  "VpcPublicSubnet1DefaultRoute3DA9E72A": {
   "Type": "AWS::EC2::Route",
   "Properties": {
    "DestinationCidrBlock": "0.0.0.0/0",
    "GatewayId": {
     "Ref": "VpcIGWD7BA715C"
    },
    "RouteTableId": {
     "Ref": "VpcPublicSubnet1RouteTable6C95E38E"
    }
   },
   "DependsOn": [
    "VpcVPCGWBF912B6E"
   ]
  },
  "VpcPublicSubnet2Subnet691E08A3": {
   "Type": "AWS::EC2::Subnet",
   "Properties": {
    "AvailabilityZone": {
     "Fn::Select": [
      1,
      {
       "Fn::GetAZs": ""
      }
     ]
    },
    "CidrBlock": "10.0.64.0/18",
    "MapPublicIpOnLaunch": true,
    "Tags": [
     {
      "Key": "aws-cdk:subnet-name",
      "Value": "Public"
     },
     {
      "Key": "aws-cdk:subnet-type",
      "Value": "Public"
     },
     {
      "Key": "Name",
      "Value": "RestrictDefaultSecurityGroupIntegTest/Vpc/PublicSubnet2"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "VpcPublicSubnet2RouteTable94F7E489": {
   "Type": "AWS::EC2::RouteTable",
   "Properties": {
    "Tags": [
     {
      "Key": "Name",
      "Value": "RestrictDefaultSecurityGroupIntegTest/Vpc/PublicSubnet2"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "VpcPublicSubnet2RouteTableAssociationDD5762D8": {
   "Type": "AWS::EC2::SubnetRouteTableAssociation",
   "Properties": {
    "RouteTableId": {
     "Ref": "VpcPublicSubnet2RouteTable94F7E489"
    },
    "SubnetId": {
     "Ref": "VpcPublicSubnet2Subnet691E08A3"
    }
   }
  },
  "VpcPublicSubnet2DefaultRoute97F91067": {
   "Type": "AWS::EC2::Route",
   "Properties": {
    "DestinationCidrBlock": "0.0.0.0/0",
    "GatewayId": {
     "Ref": "VpcIGWD7BA715C"
    },
    "RouteTableId": {
     "Ref": "VpcPublicSubnet2RouteTable94F7E489"
    }
   },
   "DependsOn": [
    "VpcVPCGWBF912B6E"
   ]
  },
  "VpcIsolatedSubnet1SubnetE48C5737": {
   "Type": "AWS::EC2::Subnet",
   "Properties": {
    "AvailabilityZone": {
     "Fn::Select": [
      0,
      {
       "Fn::GetAZs": ""
      }
     ]
    },
    "CidrBlock": "10.0.128.0/18",
    "MapPublicIpOnLaunch": false,
    "Tags": [
     {
      "Key": "aws-cdk:subnet-name",
      "Value": "Isolated"
     },
     {
      "Key": "aws-cdk:subnet-type",
      "Value": "Isolated"
     },
     {
      "Key": "Name",
      "Value": "RestrictDefaultSecurityGroupIntegTest/Vpc/IsolatedSubnet1"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "VpcIsolatedSubnet1RouteTable4771E3E5": {
   "Type": "AWS::EC2::RouteTable",
   "Properties": {
    "Tags": [
     {
      "Key": "Name",
      "Value": "RestrictDefaultSecurityGroupIntegTest/Vpc/IsolatedSubnet1"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "VpcIsolatedSubnet1RouteTableAssociationD300FCBB": {
   "Type": "AWS::EC2::SubnetRouteTableAssociation",
   "Properties": {
    "RouteTableId": {
     "Ref": "VpcIsolatedSubnet1RouteTable4771E3E5"
    },
    "SubnetId": {
     "Ref": "VpcIsolatedSubnet1SubnetE48C5737"
    }
   }
  },
  "VpcIsolatedSubnet2Subnet16364B91": {
   "Type": "AWS::EC2::Subnet",
   "Properties": {
    "AvailabilityZone": {
     "Fn::Select": [
      1,
      {
       "Fn::GetAZs": ""
      }
     ]
    },
    "CidrBlock": "10.0.192.0/18",
    "MapPublicIpOnLaunch": false,
    "Tags": [
     {
      "Key": "aws-cdk:subnet-name",
      "Value": "Isolated"
     },
     {
      "Key": "aws-cdk:subnet-type",
      "Value": "Isolated"
     },
     {
      "Key": "Name",
      "Value": "RestrictDefaultSecurityGroupIntegTest/Vpc/IsolatedSubnet2"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "VpcIsolatedSubnet2RouteTable1D30AF7D": {
   "Type": "AWS::EC2::RouteTable",
   "Properties": {
    "Tags": [
     {
      "Key": "Name",
      "Value": "RestrictDefaultSecurityGroupIntegTest/Vpc/IsolatedSubnet2"
     }
    ],
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "VpcIsolatedSubnet2RouteTableAssociationF7B18CCA": {
   "Type": "AWS::EC2::SubnetRouteTableAssociation",
   "Properties": {
    "RouteTableId": {
     "Ref": "VpcIsolatedSubnet2RouteTable1D30AF7D"
    },
    "SubnetId": {
     "Ref": "VpcIsolatedSubnet2Subnet16364B91"
    }
   }
  },
  "VpcIGWD7BA715C": {
   "Type": "AWS::EC2::InternetGateway",
   "Properties": {
    "Tags": [
     {
      "Key": "Name",
      "Value": "RestrictDefaultSecurityGroupIntegTest/Vpc"
     }
    ]
   }
  },
  "VpcVPCGWBF912B6E": {
   "Type": "AWS::EC2::VPCGatewayAttachment",
   "Properties": {
    "InternetGatewayId": {
     "Ref": "VpcIGWD7BA715C"
    },
    "VpcId": {
     "Ref": "Vpc8378EB38"
    }
   }
  },
  "RestrictDefaultSGStateMachineRole014DC528": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "states.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "RestrictDefaultSGStateMachineRoleDefaultPolicy4B169C2B": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "ec2:authorizeSecurityGroupEgress",
        "ec2:authorizeSecurityGroupIngress",
        "ec2:revokeSecurityGroupEgress",
        "ec2:revokeSecurityGroupIngress"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":ec2:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":security-group/",
          {
           "Fn::GetAtt": [
            "Vpc8378EB38",
            "DefaultSecurityGroup"
           ]
          }
         ]
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "RestrictDefaultSGStateMachineRoleDefaultPolicy4B169C2B",
    "Roles": [
     {
      "Ref": "RestrictDefaultSGStateMachineRole014DC528"
     }
    ]
   }
  },
  "RestrictDefaultSGStateMachineFD1CE043": {
   "Type": "AWS::StepFunctions::StateMachine",
   "Properties": {
    "DefinitionString": {
     "Fn::Join": [
      "",
      [
       "{\"StartAt\":\"Initialize\",\"States\":{\"Initialize\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"Next\":\"Which Request Type?\",\"Assign\":{\"RequestType\":\"{% $states.input.RequestType %}\",\"StackId\":\"{% $states.input.StackId %}\",\"RequestId\":\"{% $states.input.RequestId %}\",\"ResourceType\":\"{% $states.input.ResourceType %}\",\"LogicalResourceId\":\"{% $states.input.LogicalResourceId %}\",\"PhysicalResourceId\":\"{% $exists($states.input.PhysicalResourceId) ? $states.input.PhysicalResourceId : null %}\",\"ResourceProperties\":\"{% $states.input.ResourceProperties %}\",\"OldResourceProperties\":\"{% $exists($states.input.OldResourceProperties) ? $states.input.OldResourceProperties : null %}\"}},\"Which Request Type?\":{\"Type\":\"Choice\",\"QueryLanguage\":\"JSONata\",\"Choices\":[{\"Condition\":\"{% $RequestType = \\\"Create\\\" %}\",\"Next\":\"RevokeOnCreate: RevokeEgress\"},{\"Condition\":\"{% $RequestType = \\\"Update\\\" %}\",\"Next\":\"NewSecurityGroup?\"},{\"Condition\":\"{% $RequestType = \\\"Delete\\\" %}\",\"Next\":\"AuthorizeOnDelete: AuthorizeIngress\"}]},\"RevokeOnCreate: RevokeEgress\":{\"QueryLanguage\":\"JSONata\",\"Next\":\"RevokeOnCreate: RevokeIngress\",\"Catch\":[{\"Output\":\"{% $states.errorOutput %}\",\"ErrorEquals\":[\"States.ALL\"],\"Next\":\"RevokeOnCreate: RevokeEgressCatch\"}],\"Type\":\"Task\",\"Arguments\":{\"GroupId\":\"{% $ResourceProperties.DefaultSecurityGroupId %}\",\"IpPermissions\":[{\"IpRanges\":[{\"CidrIp\":\"0.0.0.0/0\"}],\"IpProtocol\":\"-1\"}]},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:ec2:revokeSecurityGroupEgress\"},\"RevokeOnCreate: RevokeIngress\":{\"QueryLanguage\":\"JSONata\",\"End\":true,\"Catch\":[{\"Output\":\"{% $states.errorOutput %}\",\"ErrorEquals\":[\"States.ALL\"],\"Next\":\"RevokeOnCreate: RevokeIngressCatch\"}],\"Type\":\"Task\",\"Arguments\":{\"GroupId\":\"{% $ResourceProperties.DefaultSecurityGroupId %}\",\"IpPermissions\":[{\"UserIdGroupPairs\":[{\"GroupId\":\"{% $ResourceProperties.DefaultSecurityGroupId %}\",\"UserId\":\"{% $ResourceProperties.Account %}\"}],\"IpProtocol\":\"-1\"}]},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:ec2:revokeSecurityGroupIngress\"},\"RevokeOnCreate: RevokeEgressCatch\":{\"Type\":\"Choice\",\"QueryLanguage\":\"JSONata\",\"Choices\":[{\"Condition\":\"{% $contains($states.input.Cause, 'The specified rule does not exist in this security group') %}\",\"Next\":\"RevokeOnCreate: RevokeIngress\"}],\"Default\":\"RevokeOnCreate: Fail\"},\"RevokeOnCreate: Fail\":{\"Type\":\"Fail\",\"QueryLanguage\":\"JSONata\",\"Error\":\"{% $states.input.Error %}\",\"Cause\":\"{% $states.input.Cause %}\"},\"RevokeOnCreate: RevokeIngressCatch\":{\"Type\":\"Choice\",\"QueryLanguage\":\"JSONata\",\"Choices\":[{\"Condition\":\"{% $contains($states.input.Cause, 'The specified rule does not exist in this security group') %}\",\"Next\":\"RevokeOnCreate: RevokeIngressPass\"}],\"Default\":\"RevokeOnCreate: Fail\"},\"RevokeOnCreate: RevokeIngressPass\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"End\":true},\"NewSecurityGroup?\":{\"Type\":\"Choice\",\"QueryLanguage\":\"JSONata\",\"Choices\":[{\"Condition\":\"{% $OldResourceProperties.DefaultSecurityGroupId != $ResourceProperties.DefaultSecurityGroupId %}\",\"Next\":\"AuthorizeOnUpdate: AuthorizeIngress\"}],\"Default\":\"NoChanges\"},\"NoChanges\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"End\":true},\"AuthorizeOnUpdate: AuthorizeIngress\":{\"QueryLanguage\":\"JSONata\",\"Next\":\"AuthorizeOnUpdate: AuthorizeEgress\",\"Type\":\"Task\",\"Arguments\":{\"GroupId\":\"{% $OldResourceProperties.DefaultSecurityGroupId %}\",\"IpPermissions\":[{\"UserIdGroupPairs\":[{\"GroupId\":\"{% $OldResourceProperties.DefaultSecurityGroupId %}\",\"UserId\":\"{% $ResourceProperties.Account %}\"}],\"IpProtocol\":\"-1\"}]},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:ec2:authorizeSecurityGroupIngress\"},\"AuthorizeOnUpdate: AuthorizeEgress\":{\"QueryLanguage\":\"JSONata\",\"Next\":\"RevokeOnUpdate: RevokeEgress\",\"Type\":\"Task\",\"Arguments\":{\"GroupId\":\"{% $OldResourceProperties.DefaultSecurityGroupId %}\",\"IpPermissions\":[{\"IpRanges\":[{\"CidrIp\":\"0.0.0.0/0\"}],\"IpProtocol\":\"-1\"}]},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:ec2:authorizeSecurityGroupEgress\"},\"RevokeOnUpdate: RevokeEgress\":{\"QueryLanguage\":\"JSONata\",\"Next\":\"RevokeOnUpdate: RevokeIngress\",\"Catch\":[{\"Output\":\"{% $states.errorOutput %}\",\"ErrorEquals\":[\"States.ALL\"],\"Next\":\"RevokeOnUpdate: RevokeEgressCatch\"}],\"Type\":\"Task\",\"Arguments\":{\"GroupId\":\"{% $ResourceProperties.DefaultSecurityGroupId %}\",\"IpPermissions\":[{\"IpRanges\":[{\"CidrIp\":\"0.0.0.0/0\"}],\"IpProtocol\":\"-1\"}]},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:ec2:revokeSecurityGroupEgress\"},\"RevokeOnUpdate: RevokeIngress\":{\"QueryLanguage\":\"JSONata\",\"End\":true,\"Catch\":[{\"Output\":\"{% $states.errorOutput %}\",\"ErrorEquals\":[\"States.ALL\"],\"Next\":\"RevokeOnUpdate: RevokeIngressCatch\"}],\"Type\":\"Task\",\"Arguments\":{\"GroupId\":\"{% $ResourceProperties.DefaultSecurityGroupId %}\",\"IpPermissions\":[{\"UserIdGroupPairs\":[{\"GroupId\":\"{% $ResourceProperties.DefaultSecurityGroupId %}\",\"UserId\":\"{% $ResourceProperties.Account %}\"}],\"IpProtocol\":\"-1\"}]},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:ec2:revokeSecurityGroupIngress\"},\"RevokeOnUpdate: RevokeEgressCatch\":{\"Type\":\"Choice\",\"QueryLanguage\":\"JSONata\",\"Choices\":[{\"Condition\":\"{% $contains($states.input.Cause, 'The specified rule does not exist in this security group') %}\",\"Next\":\"RevokeOnUpdate: RevokeIngress\"}],\"Default\":\"RevokeOnUpdate: Fail\"},\"RevokeOnUpdate: Fail\":{\"Type\":\"Fail\",\"QueryLanguage\":\"JSONata\",\"Error\":\"{% $states.input.Error %}\",\"Cause\":\"{% $states.input.Cause %}\"},\"RevokeOnUpdate: RevokeIngressCatch\":{\"Type\":\"Choice\",\"QueryLanguage\":\"JSONata\",\"Choices\":[{\"Condition\":\"{% $contains($states.input.Cause, 'The specified rule does not exist in this security group') %}\",\"Next\":\"RevokeOnUpdate: RevokeIngressPass\"}],\"Default\":\"RevokeOnUpdate: Fail\"},\"RevokeOnUpdate: RevokeIngressPass\":{\"Type\":\"Pass\",\"QueryLanguage\":\"JSONata\",\"End\":true},\"AuthorizeOnDelete: AuthorizeIngress\":{\"QueryLanguage\":\"JSONata\",\"Next\":\"AuthorizeOnDelete: AuthorizeEgress\",\"Type\":\"Task\",\"Arguments\":{\"GroupId\":\"{% $ResourceProperties.DefaultSecurityGroupId %}\",\"IpPermissions\":[{\"UserIdGroupPairs\":[{\"GroupId\":\"{% $ResourceProperties.DefaultSecurityGroupId %}\",\"UserId\":\"{% $ResourceProperties.Account %}\"}],\"IpProtocol\":\"-1\"}]},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:ec2:authorizeSecurityGroupIngress\"},\"AuthorizeOnDelete: AuthorizeEgress\":{\"QueryLanguage\":\"JSONata\",\"End\":true,\"Type\":\"Task\",\"Arguments\":{\"GroupId\":\"{% $ResourceProperties.DefaultSecurityGroupId %}\",\"IpPermissions\":[{\"IpRanges\":[{\"CidrIp\":\"0.0.0.0/0\"}],\"IpProtocol\":\"-1\"}]},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:ec2:authorizeSecurityGroupEgress\"}}}"
      ]
     ]
    },
    "RoleArn": {
     "Fn::GetAtt": [
      "RestrictDefaultSGStateMachineRole014DC528",
      "Arn"
     ]
    }
   },
   "DependsOn": [
    "RestrictDefaultSGStateMachineRoleDefaultPolicy4B169C2B",
    "RestrictDefaultSGStateMachineRole014DC528"
   ],
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "RestrictDefaultSG4A9037CD": {
   "Type": "Custom::VpcRestrictDefaultSG",
   "Properties": {
    "ServiceToken": {
     "Fn::Join": [
      "",
      [
       "arn:",
       {
        "Fn::Select": [
         1,
         {
          "Fn::Split": [
           ":",
           {
            "Fn::GetAtt": [
             "LambdalessProviderQueueRestrictDefaultSecurityGroupIntegTestLambdalessProviderTopicB7B9DB66D5D6B7DB",
             "Arn"
            ]
           }
          ]
         }
        ]
       },
       ":",
       {
        "Fn::Select": [
         2,
         {
          "Fn::Split": [
           ":",
           {
            "Fn::GetAtt": [
             "LambdalessProviderQueueRestrictDefaultSecurityGroupIntegTestLambdalessProviderTopicB7B9DB66D5D6B7DB",
             "Arn"
            ]
           }
          ]
         }
        ]
       },
       ":",
       {
        "Fn::Select": [
         3,
         {
          "Fn::Split": [
           ":",
           {
            "Fn::GetAtt": [
             "LambdalessProviderQueueRestrictDefaultSecurityGroupIntegTestLambdalessProviderTopicB7B9DB66D5D6B7DB",
             "Arn"
            ]
           }
          ]
         }
        ]
       },
       ":",
       {
        "Fn::Select": [
         4,
         {
          "Fn::Split": [
           ":",
           {
            "Fn::GetAtt": [
             "LambdalessProviderQueueRestrictDefaultSecurityGroupIntegTestLambdalessProviderTopicB7B9DB66D5D6B7DB",
             "Arn"
            ]
           }
          ]
         }
        ]
       },
       ":",
       {
        "Fn::Select": [
         5,
         {
          "Fn::Split": [
           ":",
           {
            "Fn::GetAtt": [
             "LambdalessProviderQueueRestrictDefaultSecurityGroupIntegTestLambdalessProviderTopicB7B9DB66D5D6B7DB",
             "Arn"
            ]
           }
          ]
         }
        ]
       }
      ]
     ]
    },
    "ServiceTimeout": "15",
    "DefaultSecurityGroupId": {
     "Fn::GetAtt": [
      "Vpc8378EB38",
      "DefaultSecurityGroup"
     ]
    },
    "Account": {
     "Ref": "AWS::AccountId"
    },
    "stateMachineArn": {
     "Ref": "RestrictDefaultSGStateMachineFD1CE043"
    }
   },
   "DependsOn": [
    "RestrictDefaultSGPolicyB2BC8CF4"
   ],
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "RestrictDefaultSGPolicyB2BC8CF4": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "states:ListExecutions",
        "states:ListStateMachines",
        "states:StartExecution"
       ],
       "Effect": "Allow",
       "Resource": {
        "Ref": "RestrictDefaultSGStateMachineFD1CE043"
       }
      },
      {
       "Action": [
        "states:DescribeExecution",
        "states:DescribeStateMachineForExecution",
        "states:GetExecutionHistory"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":states:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":execution:",
          {
           "Fn::Select": [
            6,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "RestrictDefaultSGStateMachineFD1CE043"
              }
             ]
            }
           ]
          },
          ":*"
         ]
        ]
       }
      },
      {
       "Action": [
        "states:DescribeActivity",
        "states:DescribeStateMachine",
        "states:ListActivities"
       ],
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "RestrictDefaultSGPolicyB2BC8CF4",
    "Roles": [
     {
      "Ref": "LambdalessProviderStateMachineRole4BDCD64E"
     }
    ]
   }
  },
  "LambdalessProviderTopic58DC2415": {
   "Type": "AWS::SNS::Topic"
  },
  "LambdalessProviderQueue3E954037": {
   "Type": "AWS::SQS::Queue",
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "LambdalessProviderQueuePolicy16C88515": {
   "Type": "AWS::SQS::QueuePolicy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "sqs:SendMessage",
       "Condition": {
        "ArnEquals": {
         "aws:SourceArn": {
          "Ref": "LambdalessProviderTopic58DC2415"
         }
        }
       },
       "Effect": "Allow",
       "Principal": {
        "Service": "sns.amazonaws.com"
       },
       "Resource": {
        "Fn::GetAtt": [
         "LambdalessProviderQueue3E954037",
         "Arn"
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "Queues": [
     {
      "Ref": "LambdalessProviderQueue3E954037"
     }
    ]
   }
  },
  "LambdalessProviderQueueRestrictDefaultSecurityGroupIntegTestLambdalessProviderTopicB7B9DB66D5D6B7DB": {
   "Type": "AWS::SNS::Subscription",
   "Properties": {
    "Endpoint": {
     "Fn::GetAtt": [
      "LambdalessProviderQueue3E954037",
      "Arn"
     ]
    },
    "Protocol": "sqs",
    "TopicArn": {
     "Ref": "LambdalessProviderTopic58DC2415"
    }
   },
   "DependsOn": [
    "LambdalessProviderPipeE285A459",
    "LambdalessProviderPipeRoleDefaultPolicy918C6032",
    "LambdalessProviderPipeRoleD3BC051F",
    "LambdalessProviderQueuePolicy16C88515"
   ]
  },
  "LambdalessProviderConnection803AC994": {
   "Type": "AWS::Events::Connection",
   "Properties": {
    "AuthParameters": {
     "ApiKeyAuthParameters": {
      "ApiKeyName": "dummy",
      "ApiKeyValue": "dummy"
     }
    },
    "AuthorizationType": "API_KEY"
   }
  },
  "LambdalessProviderStateMachineRole4BDCD64E": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "states.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "LambdalessProviderStateMachineRoleDefaultPolicy613E8B8C": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "states:describeExecution",
        "states:startExecution"
       ],
       "Condition": {
        "StringEquals": {
         "aws:RequestedRegion": "DISABLED"
        }
       },
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": "events:RetrieveConnectionCredentials",
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "LambdalessProviderConnection803AC994",
         "Arn"
        ]
       }
      },
      {
       "Action": [
        "secretsmanager:DescribeSecret",
        "secretsmanager:GetSecretValue"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "LambdalessProviderConnection803AC994",
         "SecretArn"
        ]
       }
      },
      {
       "Action": "states:InvokeHTTPEndpoint",
       "Condition": {
        "StringLike": {
         "states:HTTPEndpoint": "*"
        }
       },
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LambdalessProviderStateMachineRoleDefaultPolicy613E8B8C",
    "Roles": [
     {
      "Ref": "LambdalessProviderStateMachineRole4BDCD64E"
     }
    ]
   }
  },
  "LambdalessProviderStateMachine7D8C8128": {
   "Type": "AWS::StepFunctions::StateMachine",
   "Properties": {
    "DefinitionString": {
     "Fn::Join": [
      "",
      [
       "{\"StartAt\":\"Initialize\",\"States\":{\"Initialize\":{\"Type\":\"Pass\",\"Next\":\"Describe Execution\",\"Assign\":{\"ExecutionArn\":\"{% $replace($states.input.ResourceProperties.stateMachineArn, 'stateMachine', 'execution') & ':' & $states.input.RequestId %}\",\"RequestType\":\"{% $states.input.RequestType %}\",\"ResponseURL\":\"{% $states.input.ResponseURL %}\",\"StackId\":\"{% $states.input.StackId %}\",\"RequestId\":\"{% $states.input.RequestId %}\",\"ResourceType\":\"{% $states.input.ResourceType %}\",\"LogicalResourceId\":\"{% $states.input.LogicalResourceId %}\",\"PhysicalResourceId\":\"{% $exists($states.input.PhysicalResourceId) ? $states.input.PhysicalResourceId : null %}\",\"ResourceProperties\":\"{% $states.input.ResourceProperties %}\",\"OldResourceProperties\":\"{% $exists($states.input.OldResourceProperties) ? $states.input.OldResourceProperties : null %}\"}},\"Describe Execution\":{\"Next\":\"Is finished?\",\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"Next\":\"Start Execution\"}],\"Type\":\"Task\",\"Arguments\":{\"ExecutionArn\":\"{% $ExecutionArn %}\",\"IncludedData\":\"ALL_DATA\"},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:sfn:describeExecution\"},\"Still Running\":{\"Type\":\"Wait\",\"Seconds\":1,\"Next\":\"Describe Execution\"},\"Start Execution\":{\"Next\":\"Still Running\",\"Type\":\"Task\",\"Arguments\":{\"Name\":\"{% $RequestId %}\",\"Input\":{\"RequestType\":\"{% $RequestType %}\",\"StackId\":\"{% $StackId %}\",\"RequestId\":\"{% $RequestId %}\",\"ResourceType\":\"{% $ResourceType %}\",\"LogicalResourceId\":\"{% $LogicalResourceId %}\",\"PhysicalResourceId\":\"{% $PhysicalResourceId %}\",\"ResourceProperties\":\"{% $ResourceProperties %}\",\"OldResourceProperties\":\"{% $OldResourceProperties %}\"},\"StateMachineArn\":\"{% $ResourceProperties.stateMachineArn %}\"},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:sfn:startExecution\"},\"Is finished?\":{\"Type\":\"Choice\",\"Choices\":[{\"Condition\":\"{% $states.input.Status = 'RUNNING' %}\",\"Next\":\"Still Running\"},{\"Condition\":\"{% $states.input.Status = 'SUCCEEDED' %}\",\"Output\":\"{% $parse($states.input.Output) %}\",\"Next\":\"Response to CloudFormation\"}],\"Default\":\"Given workflow was failed\"},\"Given workflow was failed\":{\"Type\":\"Pass\",\"Output\":{\"Status\":\"FAILED\",\"Reason\":\"{% $states.input.Error & ': ' & $states.input.Cause %}\"},\"Next\":\"Response to CloudFormation\"},\"Response to CloudFormation\":{\"End\":true,\"Type\":\"Task\",\"Arguments\":{\"ApiEndpoint\":\"{% $match($ResponseURL, /(https://[^/]+)\\\\/(.*)\\\\?/).groups[0] & '/' & $match($ResponseURL, /(https://[^/]+)\\\\/(.*)\\\\?/).groups[1] ~> $decodeUrlComponent() %}\",\"Authentication\":{\"ConnectionArn\":\"",
       {
        "Fn::GetAtt": [
         "LambdalessProviderConnection803AC994",
         "Arn"
        ]
       },
       "\"},\"Method\":\"PUT\",\"RequestBody\":{\"Status\":\"{% $exists($states.input.Status) ? $states.input.Status : 'SUCCESS' %}\",\"StackId\":\"{% $StackId %}\",\"RequestId\":\"{% $RequestId %}\",\"LogicalResourceId\":\"{% $LogicalResourceId %}\",\"Data\":\"{% (\\n            $deepSpread := function($value, $path, $arr) {(\\n                $arr := $arr ? $arr : [];\\n                $t := $type($value);\\n                $result := \\n                $t = \\\"object\\\" ? $each($value, function($v, $k){\\n                    $deepSpread($v, $path ? $path & \\\".\\\" & $k : $k, $arr)\\n                }) : \\n                $t = \\\"array\\\" ? $map($value, function($el, $index){\\n                    $deepSpread($el, $path ? $path & \\\".\\\" & $string($index) : $string($index), $arr)\\n                }) :\\n                {\\n                    $path: $string($value)\\n                };\\n                $append($arr, $result) ~> $merge\\n            )};\\n            $exists($states.input.Data) ? $deepSpread($states.input.Data) : {}\\n            ) %}\",\"NoEcho\":\"{% $exists($states.input.NoEcho) ? $states.input.NoEcho : false %}\",\"PhysicalResourceId\":\"{% $exists($states.input.PhysicalResourceId) ? $states.input.PhysicalResourceId : $RequestId %}\",\"Reason\":\"{% $exists($states.input.Reason) ? $states.input.Reason : '' %}\"},\"QueryParameters\":\"{% $ResponseURL ~> $substringAfter('?') ~> $split('&') ~> $map(function($v) {( $kv := $split($v, '='); {$kv[0]: $decodeUrlComponent($kv[1])} )}) ~> $merge %}\"},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::http:invoke\"}},\"QueryLanguage\":\"JSONata\"}"
      ]
     ]
    },
    "RoleArn": {
     "Fn::GetAtt": [
      "LambdalessProviderStateMachineRole4BDCD64E",
      "Arn"
     ]
    },
    "StateMachineType": "EXPRESS"
   },
   "DependsOn": [
    "LambdalessProviderStateMachineRoleDefaultPolicy613E8B8C",
    "LambdalessProviderStateMachineRole4BDCD64E"
   ],
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "LambdalessProviderPipeRoleD3BC051F": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "pipes.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "LambdalessProviderPipeRoleDefaultPolicy918C6032": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "sqs:ChangeMessageVisibility",
        "sqs:DeleteMessage",
        "sqs:GetQueueAttributes",
        "sqs:GetQueueUrl",
        "sqs:ReceiveMessage"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "LambdalessProviderQueue3E954037",
         "Arn"
        ]
       }
      },
      {
       "Action": "states:StartSyncExecution",
       "Effect": "Allow",
       "Resource": {
        "Ref": "LambdalessProviderStateMachine7D8C8128"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LambdalessProviderPipeRoleDefaultPolicy918C6032",
    "Roles": [
     {
      "Ref": "LambdalessProviderPipeRoleD3BC051F"
     }
    ]
   }
  },
  "LambdalessProviderPipeE285A459": {
   "Type": "AWS::Pipes::Pipe",
   "Properties": {
    "Description": "Auto generated by AWS CDK Custom Resource",
    "RoleArn": {
     "Fn::GetAtt": [
      "LambdalessProviderPipeRoleD3BC051F",
      "Arn"
     ]
    },
    "Source": {
     "Fn::GetAtt": [
      "LambdalessProviderQueue3E954037",
      "Arn"
     ]
    },
    "SourceParameters": {
     "SqsQueueParameters": {
      "BatchSize": 1
     }
    },
    "Target": {
     "Ref": "LambdalessProviderStateMachine7D8C8128"
    },
    "TargetParameters": {
     "InputTemplate": "<$.body.Message>",
     "StepFunctionStateMachineParameters": {
      "InvocationType": "REQUEST_RESPONSE"
     }
    }
   },
   "DependsOn": [
    "LambdalessProviderPipeRoleDefaultPolicy918C6032",
    "LambdalessProviderPipeRoleD3BC051F"
   ]
  }
 },
 "Outputs": {
  "ExportsOutputFnGetAttVpc8378EB38DefaultSecurityGroupF5E0D218": {
   "Value": {
    "Fn::GetAtt": [
     "Vpc8378EB38",
     "DefaultSecurityGroup"
    ]
   },
   "Export": {
    "Name": "RestrictDefaultSecurityGroupIntegTest:ExportsOutputFnGetAttVpc8378EB38DefaultSecurityGroupF5E0D218"
   }
  }
 },
 "Parameters": {
  "BootstrapVersion": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/cdk-bootstrap/hnb659fds/version",
   "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
  }
 },
 "Rules": {
  "CheckBootstrapVersion": {
   "Assertions": [
    {
     "Assert": {
      "Fn::Not": [
       {
        "Fn::Contains": [
         [
          "1",
          "2",
          "3",
          "4",
          "5"
         ],
         {
          "Ref": "BootstrapVersion"
         }
        ]
       }
      ]
     },
     "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
    }
   ]
  }
 }
}